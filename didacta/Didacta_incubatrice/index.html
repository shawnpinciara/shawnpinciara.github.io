<!DOCTYPE html>
<html lang="en">
<head>
    <title>bassman</title>
    <meta name="description" content="Our first page">
    <meta name="keywords" content="html tutorial template">
    <meta charset="utf-8">
    <link rel="stylesheet" href="style.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.5.0/p5.min.js" integrity="sha512-WJXVjqeINVpi5XXJ2jn0BSCfp0y80IKrYh731gLRnkAS9TKc5KNt/OfLtu+fCueqdWniouJ1ubM+VI/hbo7POQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.1/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.dom.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/0.9.0/addons/p5.sound.min.js"></script>
    <!-- p5.touchgui -->
    <script src="https://unpkg.com/p5.touchgui@0.5.2/lib/p5.touchgui.js"></script>
    <script lang="text/javascript" src="https://unpkg.com/simple-web-serial@latest/dist/simple-web-serial.min.js"></script>
</head>

<body>
<div class="canvas" style="width: 100%; height: 100%;">
    <main></main>
</div>
</body>
<script>
  let gui;
  let b;
  var sensor = 9;

  const connection = SimpleWebSerial.setupSerialConnection({
      requestAccessOnPageLoad: true
  });
  // React to incoming events
  connection.on('event-from-arduino', function(data) {
      console.log('event from Arduino: ' + data)
      sensor = data;
  });

  // Send named events to the Arduino with a number, string, array or json object
  //connection.send('event-to-arduino', "Hello there, Arduino");
  p5.disableFriendlyErrors = false;
  document.title = "My beautiful p5.js sketch";
  let description = "A white disc in the center of a black canvas is growing and shrinking slowly.";
  function preload() {}

  function mapRange(value, inMin, inMax, outMin, outMax){ return outMin + (((value - inMin) / (inMax - inMin)) * (outMax - outMin))}

  function setup() {
    gui = createGui();
    b = createButton("Light on!", 20, 450);
    b2 = createButton("Light off!", 20, 500);
    createCanvas(windowWidth, windowHeight);
    background(200);
    fill(250);
    rect(20, 20, 550, 400, 20); //GRAPH
    //describe(description); // Create a screen reader accessible description for the canvas
  }
  var circle_x = 50;
  function draw() {
    drawGui();

    if(b.isPressed) {
      print(b.label + " is pressed.");
      connection.send('pixels', 255);
    }

    if(b2.isPressed) {
      print(b2.label + " is pressed.");
      connection.send('pixels', 0);
    }
    
    noStroke();
    

    fill(255,0,0);
    circle(circle_x,mapRange(sensor,900,10,30,300),5);

    circle_x+=1;
    if (circle_x >650) {
      fill(250);
      rect(20, 20, 550, 400, 20); //GRAPH
      circle_x=50;
    }

  }

  function windowResized() {
    resizeCanvas(windowWidth, windowHeight);
  }

  // Find key codes at http://keycode.info/
  function keyPressed() {
    if (keyCode === 82) {
      console.log("R was pressed");
    } else if (keyCode === 67) {
      console.log("C was pressed");
    }
  }

  // **************************
  // * HIC ET NUNC VARIABLES  *
  // **************************

  // If you want to create OBJKT's with different seeds,
  // you can access the creator and viewer wallet ids.
  // This values will only be injected once the piece has been minted
  // they will not work locally.
  const creator = new URLSearchParams(window.location.search).get("creator");
  const viewer = new URLSearchParams(window.location.search).get("viewer");
  // NOTE: if the user is viewing the page on hicetnunc while unsynced,
  // the viewer variable will return a string of value "false" (NOT a boolean)

  // The ID of the OBJKT is also passed via the URL parameters
  const objkt = new URLSearchParams(window.location.search).get("objkt");

</script>
</html>